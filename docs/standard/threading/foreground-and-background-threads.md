---
title: 前台和后台线程
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- threading [.NET Framework], foreground
- threading [.NET Framework], background
- foreground threads
- background threads
ms.assetid: cfe0d632-dd35-47e0-91ad-f742a444005e
ms.openlocfilehash: 5e7ec9e2c2a5ba3de1b4518cea15eb5f512640d3
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/02/2020
ms.locfileid: "84279680"
---
# <a name="foreground-and-background-threads"></a><span data-ttu-id="2dd52-102">前台和后台线程</span><span class="sxs-lookup"><span data-stu-id="2dd52-102">Foreground and Background Threads</span></span>
<span data-ttu-id="2dd52-103">托管线程可以是后台线程，也可以是前台线程。</span><span class="sxs-lookup"><span data-stu-id="2dd52-103">A managed thread is either a background thread or a foreground thread.</span></span> <span data-ttu-id="2dd52-104">后台线程和前台线程几乎完全相同，只有一处不同，即后台线程不会确保托管执行环境一直运行。</span><span class="sxs-lookup"><span data-stu-id="2dd52-104">Background threads are identical to foreground threads with one exception: a background thread does not keep the managed execution environment running.</span></span> <span data-ttu-id="2dd52-105">一旦托管进程（其中 .exe 文件为托管程序集）中的所有前台线程都停止，系统会停止并关闭所有后台线程。</span><span class="sxs-lookup"><span data-stu-id="2dd52-105">Once all foreground threads have been stopped in a managed process (where the .exe file is a managed assembly), the system stops all background threads and shuts down.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="2dd52-106">如果运行时因进程正在关闭而停止后台线程，不会在线程中抛出任何异常。</span><span class="sxs-lookup"><span data-stu-id="2dd52-106">When the runtime stops a background thread because the process is shutting down, no exception is thrown in the thread.</span></span> <span data-ttu-id="2dd52-107">不过，如果线程因 <xref:System.AppDomain.Unload%2A?displayProperty=nameWithType> 方法卸载应用域而停止，前台线程和后台线程中都会抛出 <xref:System.Threading.ThreadAbortException>。</span><span class="sxs-lookup"><span data-stu-id="2dd52-107">However, when threads are stopped because the <xref:System.AppDomain.Unload%2A?displayProperty=nameWithType> method unloads the application domain, a <xref:System.Threading.ThreadAbortException> is thrown in both foreground and background threads.</span></span>  
  
 <span data-ttu-id="2dd52-108"><xref:System.Threading.Thread.IsBackground%2A?displayProperty=nameWithType> 属性可用于确定是后台线程还是前台进程，也可用于更改线程状态。</span><span class="sxs-lookup"><span data-stu-id="2dd52-108">Use the <xref:System.Threading.Thread.IsBackground%2A?displayProperty=nameWithType> property to determine whether a thread is a background or a foreground thread, or to change its status.</span></span> <span data-ttu-id="2dd52-109">可以随时将线程的 <xref:System.Threading.Thread.IsBackground%2A> 属性更改为 `true`，将线程更改为后台线程。</span><span class="sxs-lookup"><span data-stu-id="2dd52-109">A thread can be changed to a background thread at any time by setting its <xref:System.Threading.Thread.IsBackground%2A> property to `true`.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="2dd52-110">线程的前台或后台状态不会影响线程中抛出未经处理的异常。</span><span class="sxs-lookup"><span data-stu-id="2dd52-110">The foreground or background status of a thread does not affect the outcome of an unhandled exception in the thread.</span></span> <span data-ttu-id="2dd52-111">在 .NET Framework 版本 2.0 中，前台线程或后台线程中未经处理的异常会导致应用终止。</span><span class="sxs-lookup"><span data-stu-id="2dd52-111">In the .NET Framework version 2.0, an unhandled exception in either foreground or background threads results in termination of the application.</span></span> <span data-ttu-id="2dd52-112">请参阅[托管线程异常](exceptions-in-managed-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="2dd52-112">See [Exceptions in Managed Threads](exceptions-in-managed-threads.md).</span></span>  
  
 <span data-ttu-id="2dd52-113">属于托管线程池的线程（即 <xref:System.Threading.Thread.IsThreadPoolThread%2A> 属性为 `true` 的线程）是后台线程。</span><span class="sxs-lookup"><span data-stu-id="2dd52-113">Threads that belong to the managed thread pool (that is, threads whose <xref:System.Threading.Thread.IsThreadPoolThread%2A> property is `true`) are background threads.</span></span> <span data-ttu-id="2dd52-114">从非托管代码进入托管执行环境的所有线程都会标记为后台线程。</span><span class="sxs-lookup"><span data-stu-id="2dd52-114">All threads that enter the managed execution environment from unmanaged code are marked as background threads.</span></span> <span data-ttu-id="2dd52-115">默认情况下，通过新建并启动 <xref:System.Threading.Thread> 对象生成的所有线程都是前台线程。</span><span class="sxs-lookup"><span data-stu-id="2dd52-115">All threads generated by creating and starting a new <xref:System.Threading.Thread> object are by default foreground threads.</span></span>  
  
 <span data-ttu-id="2dd52-116">如果使用线程监视活动（如套接字连接），请将它的 <xref:System.Threading.Thread.IsBackground%2A> 属性设置为 `true`，以便线程不会阻止进程终止。</span><span class="sxs-lookup"><span data-stu-id="2dd52-116">If you use a thread to monitor an activity, such as a socket connection, set its <xref:System.Threading.Thread.IsBackground%2A> property to `true` so that the thread does not prevent your process from terminating.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2dd52-117">另请参阅</span><span class="sxs-lookup"><span data-stu-id="2dd52-117">See also</span></span>

- <xref:System.Threading.Thread.IsBackground%2A?displayProperty=nameWithType>
- <xref:System.Threading.Thread>
- <xref:System.Threading.ThreadAbortException>
