---
title: 如何：禁用数字签名的加密
ms.date: 03/30/2017
ms.assetid: fd174313-ad81-4dca-898a-016ccaff8187
ms.openlocfilehash: 7ef305fdfd9a4ee61dfd89fdd46f2dc03a350977
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/09/2020
ms.locfileid: "84595396"
---
# <a name="how-to-disable-encryption-of-digital-signatures"></a><span data-ttu-id="79d10-102">如何：禁用数字签名的加密</span><span class="sxs-lookup"><span data-stu-id="79d10-102">How to: Disable Encryption of Digital Signatures</span></span>
<span data-ttu-id="79d10-103">默认情况下，消息已经过签名，并且已对签名进行了数字加密。</span><span class="sxs-lookup"><span data-stu-id="79d10-103">By default, a message is signed and the signature is digitally encrypted.</span></span> <span data-ttu-id="79d10-104">这可以通过以下方法进行控制，即使用 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> 或 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> 的实例创建一个自定义绑定，然后将其中一个类的 `MessageProtectionOrder` 属性设置为 <xref:System.ServiceModel.Security.MessageProtectionOrder> 枚举值。</span><span class="sxs-lookup"><span data-stu-id="79d10-104">This is controlled by creating a custom binding with an instance of the <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> or the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> and setting the `MessageProtectionOrder` property of either class to a <xref:System.ServiceModel.Security.MessageProtectionOrder> enumeration value.</span></span> <span data-ttu-id="79d10-105">默认值为 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature>。</span><span class="sxs-lookup"><span data-stu-id="79d10-105">The default is <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature>.</span></span> <span data-ttu-id="79d10-106">此过程比只进行签名和加密多用了 30% 的时间，签名和加密的时间取决于整个消息的大小（消息越小，对性能的影响越大）。</span><span class="sxs-lookup"><span data-stu-id="79d10-106">This process consumes up to 30 percent more time than simply signing and encrypting based on the overall message size (the smaller the message, the greater the performance impact).</span></span> <span data-ttu-id="79d10-107">但是，禁用签名的加密可能会使攻击者猜测消息的内容。</span><span class="sxs-lookup"><span data-stu-id="79d10-107">Disabling encryption of the signature, however, might allow an attacker to guess the content of the message.</span></span> <span data-ttu-id="79d10-108">这种情况是可能的，原因是签名元素包含消息中每个签名部分的纯文本的哈希代码。</span><span class="sxs-lookup"><span data-stu-id="79d10-108">This is possible because the signature element contains the hash code of the plain text of every signed part in the message.</span></span> <span data-ttu-id="79d10-109">例如，尽管默认情况下加密了消息正文，但是在加密之前，未加密的签名包含消息正文的哈希代码。</span><span class="sxs-lookup"><span data-stu-id="79d10-109">For example, although the message body is encrypted by default, the unencrypted signature contains the hash code of the message body before the encryption.</span></span> <span data-ttu-id="79d10-110">如果签名和加密部分可能值的集比较小，则攻击者也许就可以通过查看哈希值推导内容。</span><span class="sxs-lookup"><span data-stu-id="79d10-110">If the set of possible values for the signed and encrypted part is small, an attacker might be able to deduce the contents by looking at the hash value.</span></span> <span data-ttu-id="79d10-111">对签名进行加密可以降低此攻击的影响。</span><span class="sxs-lookup"><span data-stu-id="79d10-111">Encrypting the signature mitigates this attack vector.</span></span>  
  
 <span data-ttu-id="79d10-112">因此，只能在以下情况下禁用签名的加密：当内容的值比较低或可能的内容值集比较大且具有不确定性时；当性能的提升比减少上述攻击的重要性高时。</span><span class="sxs-lookup"><span data-stu-id="79d10-112">Therefore, disable encryption of the signature only when the value of the content is low or the set of possible content values is large and nondeterministic, and the performance gain is more important than mitigating the attack described above.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="79d10-113">如果加密的消息中没有任何内容，则不会对签名元素进行加密，即使当 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 或 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 属性被设置为 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature> 时也是如此。</span><span class="sxs-lookup"><span data-stu-id="79d10-113">If there is nothing in the message that is encrypted, the signature element is not encrypted, even when the <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature>.</span></span> <span data-ttu-id="79d10-114">系统提供的绑定同样也会出现此行为；所有由系统提供的绑定都将消息保护顺序设置为 `SignBeforeEncryptAndEncryptSignature`。</span><span class="sxs-lookup"><span data-stu-id="79d10-114">This behavior occurs even with system-provided bindings; all system-provided bindings have the message protection order set to `SignBeforeEncryptAndEncryptSignature`.</span></span> <span data-ttu-id="79d10-115">但是，Web 服务描述语言（WSDL） WCF 生成的将仍包含 `<sp:EncryptSignature>` 断言。</span><span class="sxs-lookup"><span data-stu-id="79d10-115">However, the Web Services Description Language (WSDL) WCF generates will still contain the `<sp:EncryptSignature>` assertion.</span></span>  
  
### <a name="to-disable-digital-signing"></a><span data-ttu-id="79d10-116">禁用数字签名</span><span class="sxs-lookup"><span data-stu-id="79d10-116">To disable digital signing</span></span>  
  
1. <span data-ttu-id="79d10-117">创建 <xref:System.ServiceModel.Channels.CustomBinding>。</span><span class="sxs-lookup"><span data-stu-id="79d10-117">Create a <xref:System.ServiceModel.Channels.CustomBinding>.</span></span> <span data-ttu-id="79d10-118">有关详细信息，请参阅[如何：使用 SecurityBindingElement 创建自定义绑定](how-to-create-a-custom-binding-using-the-securitybindingelement.md)。</span><span class="sxs-lookup"><span data-stu-id="79d10-118">For more information, see [How to: Create a Custom Binding Using the SecurityBindingElement](how-to-create-a-custom-binding-using-the-securitybindingelement.md).</span></span>  
  
2. <span data-ttu-id="79d10-119">将 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> 或 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> 添加到绑定集合。</span><span class="sxs-lookup"><span data-stu-id="79d10-119">Add either an <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> or a <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> to the binding collection.</span></span>  
  
3. <span data-ttu-id="79d10-120">将 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 属性设置为 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>，或将 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 属性设置为 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>。</span><span class="sxs-lookup"><span data-stu-id="79d10-120">Set the <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>, or set the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="79d10-121">另请参阅</span><span class="sxs-lookup"><span data-stu-id="79d10-121">See also</span></span>

- [<span data-ttu-id="79d10-122">使用自定义绑定的安全功能</span><span class="sxs-lookup"><span data-stu-id="79d10-122">Security Capabilities with Custom Bindings</span></span>](security-capabilities-with-custom-bindings.md)
